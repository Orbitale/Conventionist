{% extends '@EasyAdmin/page/content.html.twig' %}

{% block page_title %}
    {{ 'Calendar'|trans }}
{% endblock %}
{% block content_title %}
    {{ 'Calendar'|trans }}
{% endblock %}

{% block head_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@event-calendar/build@3.8.0/event-calendar.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.6.0/dist/event-calendar.min.js"></script>
{% endblock %}

{% block main %}
    {{ include('admin/calendar/_choose_event_list.html.twig', {events: events, event: event ?? null}, with_context = false) }}

    <hr>

    <h4>{{ 'Event:'|trans }}Â {{ event }}</h4>

    {{ include('admin/calendar/event/filters.html.twig', {
        event: event,
        filter_states: filter_states,
    }, with_context = false) }}

    {% set cols_sizes = 10 / (event.venue.floors|length) %}

    <div class="container mb-4">

        <div id="admin_event_calendar" style="max-width: 100%; min-height: 500px;"></div>

    </div>

    {{ include('admin/calendar/event/modal.html.twig', {
        event: event,
    }, with_context=false) }}
{% endblock %}

{% block body_javascript %}
    {{ parent() }}
    <script type="module">
        import displayCalendar from '{{ asset('admin/displayCalendar.js') }}';

        displayCalendar({
            elements: {
                eventModalElementId: 'event_modal',
                eventModalElementNewSlotId: 'new_slot',
                calendarElementId: 'admin_event_calendar',
            },
            locale: '{{ app.user.locale|replace({'_': '-'}) }}',
            timezone: '{{ app.request.query.get('tz')|default(app.user.timezone) }}',
            allowSelection: {{ is_granted('CAN_CREATE_TIME_SLOTS_FOR_EVENT', {event: event}) ? 'true' : 'false' }},
            data: {
                events: {{ json_schedules|json_encode|raw }},
                resources: {{ json_resources|json_encode|raw }}
            },
            event: {
                startsAt: '{{ event.startsAt|date('Y-m-d H:i:s') }}',
                endsAt: '{{ event.endsAt|date('Y-m-d H:i:s') }}',
            },
            translations: {
                unconfigured_timeslot: '{{ 'calendar.modal.unconfigured_timeslot'|trans|escape('js') }}',
            }
        });

    </script>
{% endblock %}
